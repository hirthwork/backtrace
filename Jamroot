import package ;

project
    : requirements <include>. <linkflags>-rdynamic
    ;

alias common-flags
    :
    :
    :
    : <cflags>-Wall <cxxflags>-Wall <cflags>-Wextra <cxxflags>-Wextra
      <cflags>-Werror <cxxflags>-Werror <cflags>-ansi <cxxflags>-ansi
      <cflags>-pedantic-errors <cxxflags>-pedantic-errors
    ;

alias coverage-flags
    :
    :
    :
    : <cflags>-p <cxxflags>-p <linkflags>-p <cflags>-fprofile-arcs
      <cxxflags>-fprofile-arcs <linkflags>-fprofile-arcs
      <cflags>-ftest-coverage <cxxflags>-ftest-coverage
    ;

alias extract
    : extract.c common-flags
    :
    :
    : <define>_GNU_SOURCE
    ;

obj extract-object : extract ;
obj extract-object-coverage : extract coverage-flags ;

lib dl ;

alias backtrace-sources
    : backtrace.cpp demangle.cpp dl common-flags
    ;

lib backtrace : backtrace-sources extract-object ;
lib coverage : backtrace-sources extract-object-coverage coverage-flags ;

explicit test ;
explicit coverage ;
explicit extract-object-coverage ;

package.install dist
    : <install-header-subdir>reinvented-wheels
    :
    : backtrace
    : backtrace.h backtrace.hpp demangle.hpp record.h record.hpp
    ;

