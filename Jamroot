import package : install ;
import c-std c++-std stlport ;
import noweb ;

project
    : requirements <include>. <warnings>all <warnings-as-errors>on
      <define>_GNU_SOURCE=1
      <stdlib>stlport:<define>_GLIBCXX_HAVE_WCSFTIME=1
      <cflags>-ansi <cxxflags>-ansi
      <cflags>-pedantic-errors <cxxflags>-pedantic-errors
      <cflags>-Wextra <cxxflags>-Wextra
      <linkflags>-rdynamic
    ;

lib dl : : <link>shared ;

alias libs : dl ;
alias libs : : <target-os>freebsd ;

lib backtrace : backtrace-c.c frames.c libs ;
lib backtracexx : backtrace.cpp demangle.cpp backtrace ;

install backtrace-install
    : <install-header-subdir>backtrace
    :
    : backtrace
    : backtrace.h record.h
    ;

install backtracexx-install
    : <install-header-subdir>backtrace
    :
    : backtracexx
    : backtrace.hpp demangle.hpp record.h record.hpp
    ;

use-project /test : test ;

alias basic-test
    : test/<c-std-test>on
    ;

alias toolset-test
    : basic-test/<toolset>gcc/<toolset-gcc:version>4.6
      basic-test/<toolset>gcc/<toolset-gcc:version>4.7
      basic-test/<toolset>clang
    ;

alias toolset-test-gcc-without-c1x
    : basic-test/<toolset>gcc/<toolset-gcc:version>4.3
      basic-test/<toolset>gcc/<toolset-gcc:version>4.4
      basic-test/<toolset>gcc/<toolset-gcc:version>4.5
    ;

alias toolset-test-gcc-without-c++0x
    : basic-test/<toolset>gcc/<toolset-gcc:version>4.2
    ;

alias c-std-test
    : toolset-test/<c-std>c89
      toolset-test/<c-std>c99
      toolset-test/<c-std>c1x
      toolset-test-gcc-without-c1x/<c-std>c89
      toolset-test-gcc-without-c1x/<c-std>c99
    ;

alias c++-std-test
    : c-std-test/<c++-std>c++98
      c-std-test/<c++-std>c++0x
      toolset-test-gcc-without-c++0x/<c-std>c89/<c++-std>c++98
      toolset-test-gcc-without-c++0x/<c-std>c99/<c++-std>c++98
    ;

alias stdlib-test
    : c++-std-test/<stdlib>native
      c++-std-test/<stdlib>stlport
    ;

alias variant-test
    : stdlib-test/<variant>debug
      stdlib-test/<variant>release
    ;

alias launcher-test
    : variant-test/<testing-launcher>valgrind
    ;

alias link-test
    : launcher-test/<link>static
      launcher-test/<link>shared
    ;

alias mega-test : link-test ;

explicit
    test
    basic-test
    toolset-test
    toolset-test-gcc-without-c1x
    toolset-test-gcc-without-c++0x
    c-std-test
    c++-std-test
    stdlib-test
    variant-test
    launcher-test
    link-test
    mega-test
    ;

